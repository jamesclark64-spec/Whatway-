<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Arrow to a Capital</title>
  <style>
    :root { color-scheme: light dark; }
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      margin: 0;
      padding: 16px;
      display: grid;
      gap: 12px;
      max-width: 720px;
      margin-inline: auto;
    }
    h1 { font-size: 18px; margin: 0; }
    .card {
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 14px;
      padding: 14px;
      display: grid;
      gap: 12px;
      background: rgba(127,127,127,.06);
    }
    .row { display: grid; gap: 8px; }
    .row.inline { grid-template-columns: 1fr auto; align-items: center; }
    label { font-size: 12px; opacity: .85; }
    select, button {
      font: inherit;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(127,127,127,.35);
      background: transparent;
    }
    button { cursor: pointer; }
    button:active { transform: translateY(1px); }
    .muted { font-size: 12px; opacity: .8; }

    /* Arrow area */
    .arrowWrap {
      display: grid;
      place-items: center;
      min-height: 260px;
      position: relative;
    }
    .arrow {
      width: 0;
      height: 0;
      border-left: 26px solid transparent;
      border-right: 26px solid transparent;
      border-bottom: 130px solid currentColor; /* triangle arrow */
      transform: rotate(0deg);
      transform-origin: 50% 85%;
      transition: transform 220ms ease;
      filter: drop-shadow(0 10px 12px rgba(0,0,0,.25));
    }
    .arrow::after{
      content:"";
      position:absolute;
      left:-10px;
      top:110px;
      width:20px;
      height:70px;
      background: currentColor;
      border-radius: 10px;
    }
    .ring {
      position:absolute;
      width: 220px;
      height: 220px;
      border-radius: 999px;
      border: 1px dashed rgba(127,127,127,.55);
      opacity:.8;
    }
    .nMark {
      position:absolute;
      top: 6px;
      font-size: 12px;
      opacity: .85;
    }
    .stats {
      display: grid;
      gap: 6px;
      font-variant-numeric: tabular-nums;
    }
    .big {
      font-size: 18px;
      font-weight: 700;
    }
    .grid2 {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    .pill {
      border: 1px solid rgba(127,127,127,.35);
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(127,127,127,.05);
    }
    .warn { color: #b00020; }
  </style>
</head>
<body>
  <h1>Arrow to a Capital</h1>

  <div class="card">
    <div class="row inline">
      <div class="row">
        <label for="city">Choose a capital city</label>
        <select id="city"></select>
      </div>
      <div class="row">
        <label>&nbsp;</label>
        <button id="locateBtn" type="button">üìç Locate me</button>
      </div>
    </div>

    <div class="grid2">
      <div class="pill stats">
        <div class="muted">Your location</div>
        <div id="you" class="big">Not located yet</div>
        <div id="acc" class="muted"></div>
      </div>
      <div class="pill stats">
        <div class="muted">Selected city</div>
        <div id="dest" class="big">‚Äî</div>
        <div id="destCoords" class="muted"></div>
      </div>
    </div>

    <div class="arrowWrap">
      <div class="ring"></div>
      <div class="nMark">N</div>
      <div id="arrow" class="arrow" aria-label="Direction arrow"></div>
    </div>

    <div class="grid2">
      <div class="pill stats">
        <div class="muted">Distance</div>
        <div id="distance" class="big">‚Äî</div>
        <div class="muted">Great-circle (as the crow flies)</div>
      </div>
      <div class="pill stats">
        <div class="muted">Direction</div>
        <div id="bearing" class="big">‚Äî</div>
        <div id="compass" class="muted">‚Äî</div>
      </div>
    </div>

    <div id="msg" class="muted"></div>
  </div>

<script>
(() => {
  // 6 major capitals (edit this list however you like)
  const capitals = [
    { name: "London, UK",       lat: 51.5074, lon: -0.1278 },
    { name: "Paris, France",    lat: 48.8566, lon:  2.3522 },
    { name: "Washington DC, USA", lat: 38.9072, lon: -77.0369 },
    { name: "Tokyo, Japan",     lat: 35.6762, lon: 139.6503 },
    { name: "Canberra, Australia", lat: -35.2809, lon: 149.1300 },
    { name: "Ottawa, Canada",   lat: 45.4215, lon: -75.6972 }
  ];

  const elCity = document.getElementById("city");
  const elLocate = document.getElementById("locateBtn");
  const elArrow = document.getElementById("arrow");
  const elYou = document.getElementById("you");
  const elAcc = document.getElementById("acc");
  const elDest = document.getElementById("dest");
  const elDestCoords = document.getElementById("destCoords");
  const elDistance = document.getElementById("distance");
  const elBearing = document.getElementById("bearing");
  const elCompass = document.getElementById("compass");
  const elMsg = document.getElementById("msg");

  let userPos = null; // {lat, lon, acc}

  // Populate dropdown
  capitals.forEach((c, i) => {
    const opt = document.createElement("option");
    opt.value = String(i);
    opt.textContent = c.name;
    elCity.appendChild(opt);
  });

  function toRad(deg){ return deg * Math.PI / 180; }
  function toDeg(rad){ return rad * 180 / Math.PI; }

  // Haversine distance (km)
  function distanceKm(lat1, lon1, lat2, lon2) {
    const R = 6371.0088;
    const œÜ1 = toRad(lat1), œÜ2 = toRad(lat2);
    const ŒîœÜ = toRad(lat2 - lat1);
    const ŒîŒª = toRad(lon2 - lon1);
    const a = Math.sin(ŒîœÜ/2)**2 + Math.cos(œÜ1)*Math.cos(œÜ2)*Math.sin(ŒîŒª/2)**2;
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    return R * c;
  }

  // Initial bearing (0..360, degrees, from north)
  function bearingDeg(lat1, lon1, lat2, lon2) {
    const œÜ1 = toRad(lat1), œÜ2 = toRad(lat2);
    const Œª1 = toRad(lon1), Œª2 = toRad(lon2);
    const y = Math.sin(Œª2 - Œª1) * Math.cos(œÜ2);
    const x = Math.cos(œÜ1)*Math.sin(œÜ2) - Math.sin(œÜ1)*Math.cos(œÜ2)*Math.cos(Œª2 - Œª1);
    const Œ∏ = Math.atan2(y, x);
    return (toDeg(Œ∏) + 360) % 360;
  }

  function compassLabel(b) {
    // 16-wind compass
    const dirs = ["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSW","SW","WSW","W","WNW","NW","NNW"];
    const idx = Math.round(b / 22.5) % 16;
    return dirs[idx];
  }

  function formatCoord(lat, lon) {
    const ns = lat >= 0 ? "N" : "S";
    const ew = lon >= 0 ? "E" : "W";
    return `${Math.abs(lat).toFixed(5)}¬∞${ns}, ${Math.abs(lon).toFixed(5)}¬∞${ew}`;
  }

  function updateUI() {
    const dest = capitals[Number(elCity.value)];
    elDest.textContent = dest.name;
    elDestCoords.textContent = formatCoord(dest.lat, dest.lon);

    if (!userPos) {
      elDistance.textContent = "‚Äî";
      elBearing.textContent = "‚Äî";
      elCompass.textContent = "‚Äî";
      elArrow.style.transform = `rotate(0deg)`;
      elMsg.innerHTML = `<span class="warn">Tap ‚ÄúLocate me‚Äù to enable GPS.</span>`;
      return;
    }

    elMsg.textContent = "";
    const dkm = distanceKm(userPos.lat, userPos.lon, dest.lat, dest.lon);
    const b = bearingDeg(userPos.lat, userPos.lon, dest.lat, dest.lon);

    elDistance.textContent = dkm >= 1000
      ? `${(dkm/1000).toFixed(2)}k km`
      : `${dkm.toFixed(1)} km`;

    elBearing.textContent = `${b.toFixed(1)}¬∞`;
    elCompass.textContent = `Compass: ${compassLabel(b)}`;

    // Rotate arrow so that 0¬∞ = up (north). Our arrow points up by default.
    elArrow.style.transform = `rotate(${b}deg)`;

    elYou.textContent = formatCoord(userPos.lat, userPos.lon);
    elAcc.textContent = userPos.acc ? `Accuracy: ¬±${Math.round(userPos.acc)} m` : "";
  }

  async function locate() {
    if (!navigator.geolocation) {
      elMsg.innerHTML = `<span class="warn">Geolocation isn‚Äôt supported on this device/browser.</span>`;
      return;
    }

    elMsg.textContent = "Requesting location‚Ä¶ (you may need to allow permission)";

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        userPos = {
          lat: pos.coords.latitude,
          lon: pos.coords.longitude,
          acc: pos.coords.accuracy
        };
        elMsg.textContent = "";
        updateUI();
      },
      (err) => {
        userPos = null;
        let text = "Couldn‚Äôt get location.";
        if (err.code === 1) text = "Location permission denied.";
        if (err.code === 2) text = "Location unavailable (try moving or turning GPS on).";
        if (err.code === 3) text = "Location request timed out (try again).";
        elMsg.innerHTML = `<span class="warn">${text}</span>`;
        updateUI();
      },
      { enableHighAccuracy: true, timeout: 12000, maximumAge: 0 }
    );
  }

  elLocate.addEventListener("click", locate);
  elCity.addEventListener("change", updateUI);

  // Initial
  elCity.value = "0";
  updateUI();
})();
</script>
</body>
</html>
